<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Empire Web App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        /* --- 1. –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò –ò –¶–í–ï–¢–ê --- */
        :root {
            --bg-color: #1e1e1e;       /* –°–µ—Ä–æ–≤–∞—Ç—ã–π —Ñ–æ–Ω */
            --panel-color: #2b2b2b;    /* –¶–≤–µ—Ç –±–ª–æ–∫–æ–≤ */
            --gold: #FFD700;           /* –ó–æ–ª–æ—Ç–æ */
            --text-main: #ffffff;
            --text-sec: #aaaaaa;
            --danger: #ff4d4d;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0;
            padding: 0;
            overflow: hidden; /* –ß—Ç–æ–±—ã –Ω–µ —Å–∫—Ä–æ–ª–ª–∏–ª–∞—Å—å —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Ü–µ–ª–∏–∫–æ–º */
            height: 100vh;
            display: flex;
            flex-direction: column;
        }

        /* --- 2. –®–ê–ü–ö–ê --- */
        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            background-color: var(--panel-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.3);
            z-index: 10;
        }

        .menu-btn {
            font-size: 24px;
            cursor: pointer;
            background: none;
            border: none;
            color: var(--text-main);
        }

        .balance-container {
            font-size: 18px;
            font-weight: 800;
            color: var(--gold);
            border: 1px solid var(--gold);
            padding: 5px 15px;
            border-radius: 20px;
            background: rgba(0, 0, 0, 0.3);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* --- 3. –ë–û–ö–û–í–û–ï –ú–ï–ù–Æ (SIDEBAR) --- */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 99;
            opacity: 0; pointer-events: none;
            transition: 0.3s;
        }
        .overlay.active { opacity: 1; pointer-events: all; }

        .sidebar {
            position: fixed; top: 0; left: 0; height: 100%; width: 280px;
            background: #252525;
            box-shadow: 2px 0 15px rgba(0,0,0,0.5);
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            z-index: 100;
            display: flex;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
        }
        .sidebar.active { transform: translateX(0); }

        .user-info {
            text-align: center;
            margin-bottom: 30px;
            border-bottom: 1px solid #333;
            padding-bottom: 20px;
        }
        .user-avatar { font-size: 50px; margin-bottom: 10px; display: block;}
        .user-name { font-size: 1.2rem; font-weight: bold; display: block; }
        .user-id { font-size: 0.9rem; color: var(--text-sec); display: block; margin-top: 5px; }

        .menu-item {
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 1rem;
        }
        
        /* –°—Ç–∏–ª–∏ –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π */
        .switch { position: relative; display: inline-block; width: 40px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #555; transition: .4s; border-radius: 22px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--gold); }
        input:checked + .slider:before { transform: translateX(18px); }

        .btn-exit {
            margin-top: auto;
            background: var(--danger);
            color: white;
            border: none;
            padding: 12px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
        }

        /* --- 4. –ò–ì–†–û–í–ê–Ø –ó–û–ù–ê --- */
        main {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-y: auto;
        }

        .roulette-wrapper {
            width: 100%;
            max-width: 350px;
            height: 120px;
            background: #000;
            border: 2px solid var(--gold);
            border-radius: 15px;
            overflow: hidden;
            position: relative;
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(255, 215, 0, 0.1);
        }

        /* –£–∫–∞–∑–∞—Ç–µ–ª—å –≤—ã–∏–≥—Ä—ã—à–∞ (—Å—Ç—Ä–µ–ª–æ—á–∫–∞) */
        .pointer {
            position: absolute;
            top: 0; left: 50%;
            transform: translateX(-50%);
            width: 4px; height: 100%;
            background: rgba(255, 0, 0, 0.5);
            z-index: 5;
            border-left: 1px solid red;
            border-right: 1px solid red;
        }

        .tape {
            display: flex;
            height: 100%;
            align-items: center;
            transition: transform 4s cubic-bezier(0.1, 0.9, 0.2, 1); /* –≠—Ñ—Ñ–µ–∫—Ç —Ç–æ—Ä–º–æ–∂–µ–Ω–∏—è */
            will-change: transform;
        }

        .card {
            min-width: 100px;
            height: 100px;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 50px;
            border-right: 1px solid #333;
        }

        .spin-btn {
            background: var(--gold);
            color: #000;
            border: none;
            padding: 15px 40px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.3);
            margin-bottom: 10px;
            width: 80%;
            max-width: 300px;
        }
        .spin-btn:disabled { background: #555; cursor: not-allowed; box-shadow: none; }

        .cost-label { color: #777; font-size: 0.9rem; margin-bottom: 20px; }

        /* --- 5. –¢–ê–ë–õ–ò–¶–ê –í–´–ü–õ–ê–¢ (–õ–ï–ì–ï–ù–î–ê) --- */
        .paytable {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            width: 100%;
            max-width: 400px;
            background: var(--panel-color);
            padding: 15px;
            border-radius: 15px;
        }

        .pay-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            background: rgba(0,0,0,0.2);
            padding: 8px;
            border-radius: 8px;
        }
        .pay-icon { font-size: 24px; margin-bottom: 4px; }
        .pay-val { font-size: 0.8rem; color: var(--gold); font-weight: bold; }

    </style>
</head>
<body>

    <div class="overlay" onclick="toggleMenu()"></div>
    <div class="sidebar" id="sidebar">
        <div class="user-info">
            <span class="user-avatar">üë§</span>
            <span class="user-name" id="menu-username">Loading...</span>
            <span class="user-id" id="menu-userid">ID: ...</span>
        </div>

        <div class="menu-item">
            <span data-lang="vibration">–í–∏–±—Ä–∞—Ü–∏—è</span>
            <label class="switch">
                <input type="checkbox" id="vibrateCheck" checked onchange="saveSettings()">
                <span class="slider"></span>
            </label>
        </div>

        <div class="menu-item">
            <span data-lang="language">–Ø–∑—ã–∫ (RU/EN)</span>
            <label class="switch">
                <input type="checkbox" id="langCheck" onchange="toggleLang()">
                <span class="slider"></span>
            </label>
        </div>

        <button class="btn-exit" onclick="closeApp()" data-lang="exit">–í—ã—Ö–æ–¥ —Å –≤–µ–±–∞</button>
    </div>

    <header>
        <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
        <div class="balance-container">
            <span id="balance">0</span> ‚òÖ
        </div>
    </header>

    <main>
        <h2 style="margin-top:0; color:var(--gold);" data-lang="game_title">Empire Roulette</h2>
        
        <div class="roulette-wrapper">
            <div class="pointer"></div>
            <div class="tape" id="tape">
                </div>
        </div>

        <button class="spin-btn" id="spinBtn" onclick="spin()">SPIN</button>
        <p class="cost-label"><span data-lang="cost">–°—Ç–æ–∏–º–æ—Å—Ç—å:</span> 50 ‚òÖ</p>

        <div class="paytable" id="paytable">
            </div>

        <p id="msg" style="height: 20px; color: var(--gold); font-weight: bold;"></p>
    </main>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        // --- –î–ê–ù–ù–´–ï –ò–ì–†–´ (12 –°–¢–ò–ö–ï–†–û–í) ---
        // val = –≤—ã–∏–≥—Ä—ã—à (—Å–∫–æ–ª—å–∫–æ –≤–µ—Ä–Ω–µ—Ç—Å—è –Ω–∞ –±–∞–ª–∞–Ω—Å)
        const items = [
            { icon: 'üçí', val: 0 },   // –ü—É—Å—Ç—ã—à–∫–∞
            { icon: 'üçã', val: 10 },  // –í–µ—Ä–Ω–µ—Ç 10 (–ø–æ—Ç–µ—Ä—è–ª 40)
            { icon: 'üçá', val: 25 },  // –ü–æ—Ç–µ—Ä—è–ª 25
            { icon: 'üçâ', val: 50 },  // –í–æ–∑–≤—Ä–∞—Ç —Å—Ç–∞–≤–∫–∏
            { icon: 'üîî', val: 75 },  // +25
            { icon: 'üçÄ', val: 100 }, // x2
            { icon: 'üé≤', val: 150 }, // x3
            { icon: 'üé∞', val: 200 }, // x4
            { icon: 'üé±', val: 250 }, // x5
            { icon: 'üé©', val: 300 }, // x6
            { icon: 'üëë', val: 500 }, // x10
            { icon: 'üíé', val: 1000 } // JACKPOT x20
        ];

        // --- –°–û–°–¢–û–Ø–ù–ò–ï ---
        let currentBalance = 0;
        let isSpinning = false;
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞
        const texts = {
            ru: { vibration: "–í–∏–±—Ä–∞—Ü–∏—è", language: "–Ø–∑—ã–∫ (RU/EN)", exit: "–í—ã—Ö–æ–¥ —Å –≤–µ–±–∞", game_title: "–†—É–ª–µ—Ç–∫–∞ –ò–º–ø–µ—Ä–∏–∏", cost: "–°—Ç–æ–∏–º–æ—Å—Ç—å:", msg_win: "–í–´–ò–ì–†–´–®: ", msg_lose: "–ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞", msg_no_money: "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!" },
            en: { vibration: "Vibration", language: "Language (RU/EN)", exit: "Exit Web App", game_title: "Empire Roulette", cost: "Cost:", msg_win: "YOU WON: ", msg_lose: "Try Again", msg_no_money: "Not enough funds!" }
        };

        // --- –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø ---
        function init() {
            // 1. –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ —é–∑–µ—Ä–∞
            const user = tg.initDataUnsafe.user;
            if (user) {
                document.getElementById('menu-username').innerText = user.first_name + (user.last_name ? ' ' + user.last_name : '');
                document.getElementById('menu-userid').innerText = 'ID: ' + user.id;
            } else {
                document.getElementById('menu-username').innerText = 'Guest Player';
                document.getElementById('menu-userid').innerText = 'ID: Unknown';
            }

            // 2. –ü–æ–ª—É—á–∞–µ–º –±–∞–ª–∞–Ω—Å –∏–∑ URL
            const urlParams = new URLSearchParams(window.location.search);
            const balParam = urlParams.get('balance');
            if (balParam) currentBalance = parseInt(balParam);
            updateBalanceUI();

            // 3. –ó–∞–≥—Ä—É–∂–∞–µ–º –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
            const savedSettings = JSON.parse(localStorage.getItem('empire_web_settings'));
            if (savedSettings) {
                document.getElementById('vibrateCheck').checked = savedSettings.vibrate;
                document.getElementById('langCheck').checked = (savedSettings.lang === 'en');
            }
            applyLang();

            // 4. –°—Ç—Ä–æ–∏–º –ª–µ–Ω—Ç—É (Tape) –∏ –¢–∞–±–ª–∏—Ü—É (Paytable)
            buildGame();
        }

        // --- –ü–û–°–¢–†–û–ï–ù–ò–ï –ò–ì–†–´ ---
        function buildGame() {
            const tape = document.getElementById('tape');
            const paytable = document.getElementById('paytable');

            // –ó–∞–ø–æ–ª–Ω—è–µ–º –ª–µ–Ω—Ç—É (–≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –º–Ω–æ–≥–æ –∫–æ–ø–∏–π –¥–ª—è –∏–ª–ª—é–∑–∏–∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ—Å—Ç–∏)
            // –ú—ã —Å–¥–µ–ª–∞–µ–º 50 —ç–ª–µ–º–µ–Ω—Ç–æ–≤.
            let html = '';
            for(let i=0; i<50; i++) {
                // –ü—Ä–æ—Å—Ç–æ —Å–ª—É—á–∞–π–Ω—ã–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ –¥–ª—è —Ñ–æ–Ω–∞
                const randItem = items[Math.floor(Math.random() * items.length)];
                html += `<div class="card">${randItem.icon}</div>`;
            }
            tape.innerHTML = html;

            // –ó–∞–ø–æ–ª–Ω—è–µ–º —Ç–∞–±–ª–∏—Ü—É –≤—ã–ø–ª–∞—Ç
            items.forEach(item => {
                const div = document.createElement('div');
                div.className = 'pay-item';
                div.innerHTML = `<div class="pay-icon">${item.icon}</div><div class="pay-val">${item.val}</div>`;
                paytable.appendChild(div);
            });
        }

        // --- –õ–û–ì–ò–ö–ê –ú–ï–ù–Æ ---
        function toggleMenu() {
            document.getElementById('sidebar').classList.toggle('active');
            document.querySelector('.overlay').classList.toggle('active');
            haptic('light');
        }

        function closeApp() {
            haptic('medium');
            tg.close();
        }

        function saveSettings() {
            const settings = {
                vibrate: document.getElementById('vibrateCheck').checked,
                lang: document.getElementById('langCheck').checked ? 'en' : 'ru'
            };
            localStorage.setItem('empire_web_settings', JSON.stringify(settings));
        }

        function toggleLang() {
            saveSettings();
            applyLang();
        }

        function applyLang() {
            const isEn = document.getElementById('langCheck').checked;
            const t = isEn ? texts.en : texts.ru;
            
            document.querySelector('[data-lang="vibration"]').innerText = t.vibration;
            document.querySelector('[data-lang="language"]').innerText = t.language;
            document.querySelector('[data-lang="exit"]').innerText = t.exit;
            document.querySelector('[data-lang="game_title"]').innerText = t.game_title;
            document.querySelector('[data-lang="cost"]').innerText = t.cost;
        }

        function haptic(type) {
            if (document.getElementById('vibrateCheck').checked) {
                tg.HapticFeedback.impactOccurred(type);
            }
        }

        // --- –õ–û–ì–ò–ö–ê –ò–ì–†–´ (SPIN) ---
        function spin() {
            if (isSpinning) return;
            const isEn = document.getElementById('langCheck').checked;
            const t = isEn ? texts.en : texts.ru;

            if (currentBalance < 50) {
                document.getElementById('msg').innerText = t.msg_no_money;
                haptic('error');
                return;
            }

            // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
            currentBalance -= 50;
            updateBalanceUI();
            document.getElementById('msg').innerText = "";
            
            isSpinning = true;
            document.getElementById('spinBtn').disabled = true;
            haptic('medium');

            // 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç –ó–ê–†–ê–ù–ï–ï
            const winIndex = Math.floor(Math.random() * items.length);
            const winItem = items[winIndex];

            // 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Ñ–∏–Ω–∞–ª—å–Ω—É—é –ª–µ–Ω—Ç—É —Ç–∞–∫, —á—Ç–æ–±—ã –Ω—É–∂–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –æ–∫–∞–∑–∞–ª—Å—è –ø–æ–¥ —Å—Ç—Ä–µ–ª–∫–æ–π
            // –®–∏—Ä–∏–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ 100px. –¶–µ–Ω—Ç—Ä —ç–∫—Ä–∞–Ω–∞ –ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–∞ 350px/2 = 175.
            // –ù–∞–º –Ω—É–∂–Ω–æ —Å–¥–≤–∏–Ω—É—Ç—å –ª–µ–Ω—Ç—É —Ç–∞–∫, —á—Ç–æ–±—ã –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤—Å—Ç–∞–ª –≤ —Ü–µ–Ω—Ç—Ä.
            // –î–æ–±–∞–≤–∏–º –∫ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–π –ª–µ–Ω—Ç–µ –µ—â–µ –∫—É—Å–æ–∫, –≥–¥–µ –≤ –∫–æ–Ω—Ü–µ –±—É–¥–µ—Ç –Ω–∞—à —Ä–µ–∑—É–ª—å—Ç–∞—Ç.
            
            const tape = document.getElementById('tape');
            // –û—á–∏—â–∞–µ–º –∏ –ø–µ—Ä–µ—Å–æ–∑–¥–∞–µ–º –ª–µ–Ω—Ç—É –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã –∞–Ω–∏–º–∞—Ü–∏–∏
            let newHtml = '';
            // 20 —Ä–∞–Ω–¥–æ–º–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤ "—Ä–∞–∑–≥–æ–Ω–∞"
            for(let i=0; i<25; i++) {
                const r = items[Math.floor(Math.random() * items.length)];
                newHtml += `<div class="card">${r.icon}</div>`;
            }
            // 26-–π —ç–ª–µ–º–µ–Ω—Ç - –ù–ê–® –í–´–ò–ì–†–´–®
            newHtml += `<div class="card" id="target-card">${winItem.icon}</div>`;
            // –ï—â–µ 4 —ç–ª–µ–º–µ–Ω—Ç–∞ –ø–æ—Å–ª–µ
            for(let i=0; i<4; i++) {
                const r = items[Math.floor(Math.random() * items.length)];
                newHtml += `<div class="card">${r.icon}</div>`;
            }
            
            tape.innerHTML = newHtml;
            tape.style.transition = 'none';
            tape.style.transform = 'translateX(0)';

            // –§–æ—Ä—Å–∏—Ä—É–µ–º –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫—É
            tape.offsetHeight; 

            // 3. –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            // –ù–∞–º –Ω—É–∂–Ω–æ —Å–¥–≤–∏–Ω—É—Ç—å –ª–µ–Ω—Ç—É –≤–ª–µ–≤–æ —Ç–∞–∫, —á—Ç–æ–±—ã "target-card" –æ–∫–∞–∑–∞–ª—Å—è –ø–æ —Ü–µ–Ω—Ç—Ä—É.
            // –ö–∞—Ä—Ç–æ—á–∫–∞ 26-—è (–∏–Ω–¥–µ–∫—Å 25). 25 * 100px = 2500px.
            // –¶–µ–Ω—Ç—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (350px) = 175px. –¶–µ–Ω—Ç—Ä –∫–∞—Ä—Ç–æ—á–∫–∏ (100px) = 50px.
            // –°–º–µ—â–µ–Ω–∏–µ: -(2500 - 175 + 50) = -2375px (–ø—Ä–∏–º–µ—Ä–Ω–æ, –ø–æ–¥–≥–æ–Ω–∏–º –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏)
            // –£–ø—Ä–æ—Å—Ç–∏–º: —Å–¥–≤–∏–≥–∞–µ–º –Ω–∞ (25 * 100) + –∫–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–ª—è —Ü–µ–Ω—Ç—Ä–æ–≤–∫–∏.
            // –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞: ContainerWidth/2 - CardWidth/2 = 350/2 - 100/2 = 175 - 50 = 125px.
            // Target Position = - (Index * 100) + 125.
            
            const targetPos = -(25 * 100) + 125;
            
            tape.style.transition = 'transform 3s cubic-bezier(0.15, 0.85, 0.35, 1.0)'; // –ü–ª–∞–≤–Ω–æ–µ —Ç–æ—Ä–º–æ–∂–µ–Ω–∏–µ
            tape.style.transform = `translateX(${targetPos}px)`;

            // 4. –ñ–¥–µ–º –æ–∫–æ–Ω—á–∞–Ω–∏—è –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                isSpinning = false;
                document.getElementById('spinBtn').disabled = false;
                
                // –ù–∞—á–∏—Å–ª—è–µ–º –≤—ã–∏–≥—Ä—ã—à
                if (winItem.val > 0) {
                    currentBalance += winItem.val;
                    document.getElementById('msg').innerText = `${t.msg_win} ${winItem.val} ‚òÖ`;
                    document.getElementById('msg').style.color = "#00ff00"; // –ó–µ–ª–µ–Ω—ã–π —Ç–µ–∫—Å—Ç
                    haptic('success');
                } else {
                    document.getElementById('msg').innerText = t.msg_lose;
                    document.getElementById('msg').style.color = "#ff4d4d"; // –ö—Ä–∞—Å–Ω—ã–π —Ç–µ–∫—Å—Ç
                }
                updateBalanceUI();

            }, 3000); // –í—Ä–µ–º—è –∞–Ω–∏–º–∞—Ü–∏–∏
        }

        function updateBalanceUI() {
            document.getElementById('balance').innerText = currentBalance;
        }

        // –ó–∞–ø—É—Å–∫
        init();
    </script>
</body>
</html>
