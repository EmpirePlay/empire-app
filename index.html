<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Empire Web App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --bg-color: #1e1e1e;
            --panel-color: #2b2b2b;
            --gold: #FFD700;
            --text-main: #ffffff;
            --danger: #ff4d4d;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-main);
            font-family: 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            margin: 0; padding: 0;
            overflow: hidden;
            height: 100vh;
            display: flex; flex-direction: column;
        }

        /* --- –®–ê–ü–ö–ê --- */
        header {
            display: flex; justify-content: space-between; align-items: center;
            padding: 15px 20px;
            background-color: var(--panel-color);
            box-shadow: 0 2px 10px rgba(0,0,0,0.5);
            z-index: 20;
        }
        .menu-btn { font-size: 24px; cursor: pointer; background: none; border: none; color: white; }
        .balance-box { font-size: 18px; font-weight: bold; color: var(--gold); border: 1px solid var(--gold); padding: 5px 15px; border-radius: 20px; background: rgba(0,0,0,0.4); }

        /* --- –ú–ï–ù–Æ (SIDEBAR) --- */
        .overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 90;
            opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .overlay.active { opacity: 1; pointer-events: all; }

        .sidebar {
            position: fixed; top: 0; left: 0; height: 100%; width: 260px;
            background: #252525; z-index: 100;
            transform: translateX(-100%); transition: transform 0.3s ease;
            display: flex; flex-direction: column; padding: 20px; box-sizing: border-box;
            box-shadow: 2px 0 20px rgba(0,0,0,0.5);
        }
        .sidebar.active { transform: translateX(0); }

        .user-info { text-align: center; margin-bottom: 30px; border-bottom: 1px solid #444; padding-bottom: 20px; }
        .user-avatar { font-size: 40px; margin-bottom: 10px; display: block; }
        .user-name { font-size: 1.1rem; font-weight: bold; display: block; color: var(--gold); }
        .user-id { font-size: 0.85rem; color: #aaa; margin-top: 5px; display: block; }

        .menu-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .btn-exit { margin-top: auto; background: var(--danger); color: white; border: none; padding: 12px; border-radius: 8px; width: 100%; font-weight: bold; cursor: pointer; }

        /* –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å */
        .switch { position: relative; display: inline-block; width: 40px; height: 22px; }
        .switch input { opacity: 0; width: 0; height: 0; }
        .slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: #555; transition: .4s; border-radius: 22px; }
        .slider:before { position: absolute; content: ""; height: 16px; width: 16px; left: 3px; bottom: 3px; background-color: white; transition: .4s; border-radius: 50%; }
        input:checked + .slider { background-color: var(--gold); }
        input:checked + .slider:before { transform: translateX(18px); }

        /* --- –ò–ì–†–ê --- */
        main { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: flex-start; padding-top: 40px; }
        
        h2 { color: var(--gold); margin-bottom: 20px; text-transform: uppercase; letter-spacing: 2px; }

        .roulette-container {
            width: 300px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –æ–∫–Ω–∞ */
            height: 100px;
            background: #111;
            border: 2px solid var(--gold);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
            margin-bottom: 20px;
            box-shadow: 0 0 25px rgba(212, 175, 55, 0.15);
        }

        .pointer {
            position: absolute; top: 0; left: 50%; transform: translateX(-50%);
            width: 4px; height: 100%; background: red; z-index: 10;
            box-shadow: 0 0 5px red;
        }

        .tape {
            display: flex;
            height: 100%;
            align-items: center;
            /* –ù–∞—á–∞–ª—å–Ω–∞—è –ø–æ–∑–∏—Ü–∏—è –±—É–¥–µ—Ç –∑–∞–¥–∞–Ω–∞ –≤ JS */
            will-change: transform;
        }

        .card {
            width: 80px; /* –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —à–∏—Ä–∏–Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∏ */
            height: 80px;
            flex-shrink: 0; /* –í–ê–ñ–ù–û: –ù–µ —Å–∂–∏–º–∞—Ç—å –∫–∞—Ä—Ç–æ—á–∫–∏! */
            display: flex; justify-content: center; align-items: center;
            font-size: 40px;
            border-right: 1px solid #333;
            box-sizing: border-box;
        }

        .spin-btn {
            background: var(--gold); color: #000; border: none; padding: 15px 50px;
            font-size: 1.2rem; font-weight: bold; border-radius: 30px; cursor: pointer;
            box-shadow: 0 5px 15px rgba(255, 215, 0, 0.3); transition: transform 0.1s;
        }
        .spin-btn:active { transform: scale(0.95); }
        .spin-btn:disabled { background: #555; cursor: not-allowed; box-shadow: none; }

        .status-msg { height: 20px; margin-top: 15px; font-weight: bold; color: var(--gold); }

        /* –¢–∞–±–ª–∏—Ü–∞ –≤—ã–ø–ª–∞—Ç */
        .paytable {
            display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px;
            margin-top: 30px; background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;
        }
        .pay-item { text-align: center; }
        .pay-val { font-size: 0.75rem; color: #aaa; margin-top: 2px; }

    </style>
</head>
<body>

    <div class="overlay" onclick="toggleMenu()"></div>
    <div class="sidebar" id="sidebar">
        <div class="user-info">
            <span class="user-avatar">üòé</span>
            <span class="user-name" id="username">–ó–∞–≥—Ä—É–∑–∫–∞...</span>
            <span class="user-id" id="userid">ID: ...</span>
        </div>
        
        <div class="menu-item">
            <span>–í–∏–±—Ä–∞—Ü–∏—è</span>
            <label class="switch"><input type="checkbox" id="vibrateCheck" checked><span class="slider"></span></label>
        </div>
        <div class="menu-item">
            <span>–Ø–∑—ã–∫ (RU/EN)</span>
            <label class="switch"><input type="checkbox" id="langCheck"><span class="slider"></span></label>
        </div>

        <button class="btn-exit" onclick="tg.close()">–í—ã—Ö–æ–¥ —Å –≤–µ–±–∞</button>
    </div>

    <header>
        <button class="menu-btn" onclick="toggleMenu()">‚ò∞</button>
        <div class="balance-box"><span id="balance">0</span> ‚òÖ</div>
    </header>

    <main>
        <h2>ROULETTE</h2>
        
        <div class="roulette-container">
            <div class="pointer"></div>
            <div class="tape" id="tape">
                </div>
        </div>

        <button class="spin-btn" id="spinBtn" onclick="spin()">SPIN (50‚òÖ)</button>
        <div class="status-msg" id="status">–£–¥–∞—á–∏!</div>

        <div class="paytable" id="paytable"></div>
    </main>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        // –î–∞–Ω–Ω—ã–µ: –ò–∫–æ–Ω–∫–∞ –∏ –í—ã–∏–≥—Ä—ã—à
        const items = [
            { icon: 'üí©', val: 0 },
            { icon: 'üçã', val: 10 },
            { icon: 'üçí', val: 25 },
            { icon: 'üçâ', val: 50 },  // –í–æ–∑–≤—Ä–∞—Ç
            { icon: 'üîî', val: 75 },
            { icon: 'üé≤', val: 100 }, // x2
            { icon: 'üé∞', val: 150 }, // x3
            { icon: 'üíé', val: 250 }, // x5
            { icon: 'üëë', val: 500 }, // x10
            { icon: 'üî•', val: 1000 } // Jackpot
        ];

        let balance = 0;
        let isSpinning = false;
        const CARD_WIDTH = 80; // –®–∏—Ä–∏–Ω–∞ –æ–¥–Ω–æ–π –∫–∞—Ä—Ç–∏–Ω–∫–∏ (–∫–∞–∫ –≤ CSS)
        const CONTAINER_WIDTH = 300; // –®–∏—Ä–∏–Ω–∞ –æ–∫–Ω–∞ —Ä—É–ª–µ—Ç–∫–∏ (–∫–∞–∫ –≤ CSS)

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        window.onload = function() {
            // 1. –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            if (tg.initDataUnsafe && tg.initDataUnsafe.user) {
                const user = tg.initDataUnsafe.user;
                document.getElementById('username').innerText = user.first_name;
                document.getElementById('userid').innerText = 'ID: ' + user.id;
            } else {
                document.getElementById('username').innerText = "–ì–æ—Å—Ç—å";
                document.getElementById('userid').innerText = "ID: –ù–µ–∏–∑–≤–µ—Å—Ç–µ–Ω";
            }

            // 2. –ë–∞–ª–∞–Ω—Å –∏–∑ URL
            const urlParams = new URLSearchParams(window.location.search);
            const balParam = urlParams.get('balance');
            if(balParam) balance = parseInt(balParam);
            updateBalance();

            // 3. –†–∏—Å—É–µ–º —Ç–∞–±–ª–∏—Ü—É –≤—ã–ø–ª–∞—Ç
            const pt = document.getElementById('paytable');
            items.forEach(i => {
                pt.innerHTML += `<div class="pay-item"><div>${i.icon}</div><div class="pay-val">${i.val}</div></div>`;
            });

            // 4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º —Å—Ç–∞—Ä—Ç–æ–≤—É—é –ª–µ–Ω—Ç—É (–ø—Ä–æ—Å—Ç–æ –¥–ª—è –≤–∏–¥–∞)
            generateTape(false);
        };

        function toggleMenu() {
            document.getElementById('sidebar').classList.toggle('active');
            document.querySelector('.overlay').classList.toggle('active');
        }

        function updateBalance() {
            document.getElementById('balance').innerText = balance;
        }

        // –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ª–µ–Ω—Ç—ã. 
        // winItem - –æ–±—ä–µ–∫—Ç –≤—ã–∏–≥—Ä—ã—à–∞ (–µ—Å–ª–∏ null, —Ç–æ –ø—Ä–æ—Å—Ç–æ —Ä–∞–Ω–¥–æ–º)
        function generateTape(winItem) {
            const tape = document.getElementById('tape');
            let html = '';
            
            // –ï—Å–ª–∏ –º—ã –ø—Ä–æ—Å—Ç–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º (–Ω–µ –∫—Ä—É—Ç–∏–º), —Å–æ–∑–¥–∞–µ–º –∫–æ—Ä–æ—Ç–∫—É—é –ª–µ–Ω—Ç—É
            if (!winItem) {
                for(let i=0; i<10; i++) {
                    const r = items[Math.floor(Math.random() * items.length)];
                    html += `<div class="card">${r.icon}</div>`;
                }
                tape.innerHTML = html;
                tape.style.transform = 'translateX(0px)';
                return;
            }

            // –ï–°–õ–ò –ö–†–£–¢–ò–ú:
            // 1. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º 30 —Å–ª—É—á–∞–π–Ω—ã—Ö –∫–∞—Ä—Ç –¥–æ –≤—ã–∏–≥—Ä—ã—à–∞
            for(let i=0; i<30; i++) {
                const r = items[Math.floor(Math.random() * items.length)];
                html += `<div class="card">${r.icon}</div>`;
            }
            // 2. –í—Å—Ç–∞–≤–ª—è–µ–º –í–´–ò–ì–†–´–®–ù–£–Æ –∫–∞—Ä—Ç—É (31-—è –ø–æ —Å—á–µ—Ç—É, –∏–Ω–¥–µ–∫—Å 30)
            html += `<div class="card" id="winner-card">${winItem.icon}</div>`;
            // 3. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –µ—â–µ 5 –∫–∞—Ä—Ç –ø–æ—Å–ª–µ
            for(let i=0; i<5; i++) {
                const r = items[Math.floor(Math.random() * items.length)];
                html += `<div class="card">${r.icon}</div>`;
            }
            
            tape.innerHTML = html;
        }

        function spin() {
            if(isSpinning) return;
            if(balance < 50) {
                document.getElementById('status').innerText = "–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤!";
                if(document.getElementById('vibrateCheck').checked) tg.HapticFeedback.notificationOccurred('error');
                return;
            }

            // –°–ø–∏—Å—ã–≤–∞–µ–º —Å—Ç–∞–≤–∫—É
            balance -= 50;
            updateBalance();
            
            isSpinning = true;
            document.getElementById('spinBtn').disabled = true;
            document.getElementById('status').innerText = "–ö—Ä—É—Ç–∏–º...";

            // 1. –í—ã–±–∏—Ä–∞–µ–º –ø–æ–±–µ–¥–∏—Ç–µ–ª—è –∑–∞—Ä–∞–Ω–µ–µ
            const winItem = items[Math.floor(Math.random() * items.length)];

            // 2. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ª–µ–Ω—Ç—É —Å —ç—Ç–∏–º –ø–æ–±–µ–¥–∏—Ç–µ–ª–µ–º
            generateTape(winItem);

            const tape = document.getElementById('tape');

            // 3. –°–ë–†–û–° (–í–ê–ñ–ù–û!): –°—Ç–∞–≤–∏–º –ª–µ–Ω—Ç—É –≤ –Ω–∞—á–∞–ª–æ –º–≥–Ω–æ–≤–µ–Ω–Ω–æ
            tape.style.transition = 'none';
            tape.style.transform = 'translateX(0px)';
            
            // 4. FORCED REFLOW (–ú–∞–≥–∏—è, —á—Ç–æ–±—ã –±—Ä–∞—É–∑–µ—Ä –ø–æ–Ω—è–ª, —á—Ç–æ –º—ã –≤ –Ω–∞—á–∞–ª–µ)
            tape.offsetHeight; 

            // 5. –í—ã—á–∏—Å–ª—è–µ–º –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã —Ü–µ–Ω—Ç—Ä–∞
            // –ù–∞–º –Ω—É–∂–Ω–æ, —á—Ç–æ–±—ã 31-—è –∫–∞—Ä—Ç–∞ (–∏–Ω–¥–µ–∫—Å 30) –≤—Å—Ç–∞–ª–∞ –ø–æ —Ü–µ–Ω—Ç—Ä—É –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞.
            // –ü–æ–∑–∏—Ü–∏—è –∫–∞—Ä—Ç—ã = 30 * 80px = 2400px.
            // –¶–µ–Ω—Ç—Ä –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ = 300 / 2 = 150px.
            // –¶–µ–Ω—Ç—Ä –∫–∞—Ä—Ç—ã = 80 / 2 = 40px.
            // –°–º–µ—â–µ–Ω–∏–µ = - (–ü–æ–∑–∏—Ü–∏—è–ö–∞—Ä—Ç—ã) + (–¶–µ–Ω—Ç—Ä–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ - –¶–µ–Ω—Ç—Ä–ö–∞—Ä—Ç—ã)
            // –°–º–µ—â–µ–Ω–∏–µ = -2400 + (150 - 40) = -2400 + 110 = -2290px.
            
            const targetIndex = 30; // –≠—Ç–æ 31-–π —ç–ª–µ–º–µ–Ω—Ç
            const centerOffset = (CONTAINER_WIDTH / 2) - (CARD_WIDTH / 2); // 150 - 40 = 110
            const targetPos = - (targetIndex * CARD_WIDTH) + centerOffset;

            // 6. –ó–∞–ø—É—Å–∫–∞–µ–º –∞–Ω–∏–º–∞—Ü–∏—é
            tape.style.transition = 'transform 3s cubic-bezier(0.2, 0.8, 0.2, 1)'; // –≠—Ñ—Ñ–µ–∫—Ç –∑–∞–º–µ–¥–ª–µ–Ω–∏—è
            tape.style.transform = `translateX(${targetPos}px)`;
            
            // –í–∏–±—Ä–∞—Ü–∏—è –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
            if(document.getElementById('vibrateCheck').checked) tg.HapticFeedback.impactOccurred('medium');

            // 7. –û–∫–æ–Ω—á–∞–Ω–∏–µ –∞–Ω–∏–º–∞—Ü–∏–∏
            setTimeout(() => {
                isSpinning = false;
                document.getElementById('spinBtn').disabled = false;

                if(winItem.val > 0) {
                    balance += winItem.val;
                    document.getElementById('status').innerText = `–í–´–ò–ì–†–´–®: ${winItem.val} ‚òÖ`;
                    document.getElementById('status').style.color = "#0f0";
                    if(document.getElementById('vibrateCheck').checked) tg.HapticFeedback.notificationOccurred('success');
                } else {
                    document.getElementById('status').innerText = "–ü—É—Å—Ç–æ...";
                    document.getElementById('status').style.color = "#aaa";
                }
                updateBalance();

            }, 3000); // –î–æ–ª–∂–Ω–æ —Å–æ–≤–ø–∞–¥–∞—Ç—å —Å–æ –≤—Ä–µ–º–µ–Ω–µ–º transition (3s)
        }
    </script>
</body>
</html>
